## Overview

NestJS REST API starter that integrates with Supabase for authentication and profile management. The project exposes:

- `GET /api/health` – unauthenticated health check
- `GET /api/profiles/me` – fetch the current Supabase user's profile
- `PUT /api/profiles/me` – upsert the current Supabase user's profile

The profile endpoints expect a `profiles` table in Supabase with `id` (uuid, primary key), `username`, `full_name`, `avatar_url`, `created_at`, and `updated_at` columns.

## Getting started

1. Copy `.env.example` to `.env` and fill in your Supabase project credentials:

   ```bash
   cp .env.example .env
   ```

   - `SUPABASE_URL` – Supabase project URL
   - `SUPABASE_SERVICE_ROLE_SECRET` – Service role secret (keep this secret)
   - `PORT` – optional, defaults to `3000`

2. Install dependencies:

   ```bash
   npm install
   ```

3. Run the API:

   ```bash
   # development
   npm run start:dev

   # production build
   npm run build && npm run start:prod
   ```

4. Call the endpoints with a Supabase access token:

   ```bash
   curl http://localhost:3000/api/profiles/me \
     -H "Authorization: Bearer <access_token>"
   ```

   Replace `<access_token>` with a JWT generated by Supabase Auth (e.g., from the client SDK).

## Testing

```bash
npm run test:e2e
```

The e2e test suite verifies the health endpoint and does not require Supabase credentials.

## Next steps

- Extend `ProfilesService` with additional queries or join logic.
- Add more modules that reuse the injected Supabase client via `SupabaseService`.
- Integrate Nest guards/interceptors for finer-grained authorization based on Supabase roles.
